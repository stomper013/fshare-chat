<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
    if ('{{room}}' == '') location.href = '/';

    var socket = io();
    socket.emit("joinRoom", '{{ username}}', '{{room}}', {{ newRoom }});

    socket.on("new-user-joined", function (name, room) {
        if (room == '{{room}}') {
            $('.col-sm-2 ul.whosonline').append('<li><a href="#" id="' + name + '">' + name + '</a></li>');
        }
    });

    socket.on("user-left-room", function (room, name) {
        if (room == '{{room}}') {
            console.log('User "' + name + '" disconnected');
            $('#' + name).parent().remove();
        }
    });

    socket.on("message", function (msg, room) {
        if (room == '{{room}}') {
            $('.chat-panel').append(msg + "\n");
            $('.chat-panel').scrollTop($('.chat-panel')[0].scrollHeight);
        }
    });

    socket.on('game', function (gameQ) {
        $('.chat-panel').append(gameQ + "\n");
        $('.chat-panel').scrollTop($('.chat-panel')[0].scrollHeight);
    });

    socket.on('update-history', function (history) {
        console.log(history);
        $('.chat-panel').html(history);
        $('.chat-panel').scrollTop($('.chat-panel')[0].scrollHeight);
    });

    socket.on('new-room-created', function (roomNo) {
        console.log('new-room-created room%d', roomNo);
        $('.roomslist').append('<li><a href="/join?room=' + roomNo + '">#' + roomNo + '</a></li>');
    });

    socket.on('redirect', function (href) {
        location.href = href;
    });

    window.onbeforeunload = function () {
        socket.emit('disconnect');
    };

    var waitasec = false;
    function sendmsg(msg) {
        if (waitasec) {
            alert('One message per second, please!!!');
            return;
        }

        $('.chat-panel').append("Me: " + msg + "\n");
        $('.msg-input-box').val("");
        $('.chat-panel').scrollTop($('.chat-panel')[0].scrollHeight);

        socket.emit('message', '{{username}}', msg, '{{room}}');

        waitasec = true;
        setTimeout(function () { waitasec = false; }, 1000);
    }


    $(document).ready(function () {
        $(".msg-input-box").keydown(function (e) {
            if (e.which == 13) {
                e.preventDefault();
                sendmsg($(this).val());
            }
        });
    });

</script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
    integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous" />
<link rel="stylesheet" href="/stylesheets/admin.css" />

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Home</title>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12 border" style="background-color: #dfe4ea">
                <div class="row">
                    <div class="col-sm-2 box_2">
                        <img src="https://www.fshare.vn/images/logo-new-year-320x100.gif" class="rounded mt-2"
                            width="200vh" height="65vh" />
                    </div>

                    <div class="col-sm-10 box_2">
                        <div class="row">
                            <div class="col-sm-1 box_2_1">
                                {{!-- <h4 class="display-5"> Người Dùng <i class="far fa-bell"></i></h4> --}}
                            </div>

                            <div class="col-sm-8 box_2_2">
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" placeholder="Tìm Kiếm" id="tim"
                                        name="tim" />
                                    <div class="input-group-append">
                                        <button class="btn" type="button" style="background: #cd1417; color: white">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-3 box_2_3">
                                <div class="dropdown">
                                    <button type="button" class="btn btn dropdown-toggle" data-toggle="dropdown"
                                        style="background-color: #cd1417; color: white">Tùy Chọn
                                    </button>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item" href="#">Tài Khoản</a>
                                        <a class="dropdown-item" href="#">Đăng Xuất</a>
                                        <a class="dropdown-item" href="#">Cài Đặt</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-2 box_users border">
                <div>
                    <ul class="whosonline">
                        {{#roomUsers}}
                        <li><a href="#" id="{{.}}">{{.}}</a></li>
                        {{/roomUsers}}
                    </ul>
                </div>
            </div>
            <div class="col-sm-10"></div>
        </div>
    </div>
</body>

</html>